---
import { ViewTransitions } from 'astro:transitions';
import Analytics from '@vercel/analytics/astro';
import SpeedInsights from '@vercel/speed-insights/astro';

interface Props {
  title: string;
  description?: string;
  backLink?: string;
}

const { title, description, backLink } = Astro.props;
const currentPath = Astro.url.pathname;
const isBlogPost = currentPath !== '/' && currentPath !== '/thoughts' && currentPath !== '/thoughts/' && currentPath !== '/about' && currentPath !== '/about/' && currentPath !== '/projects' && currentPath !== '/projects/' && currentPath !== '/experiments' && currentPath !== '/experiments/';
const isExperiments = currentPath === '/experiments' || currentPath === '/experiments/';
const isProjects = currentPath === '/projects' || currentPath === '/projects/';
const isAbout = currentPath === '/about' || currentPath === '/about/';

// Default OG values
const ogTitle = title;
const ogDescription = description || "Broderick's personal website";
const ogImage = `${Astro.site}og-image.png?title=${encodeURIComponent(title)}${description ? `&description=${encodeURIComponent(description)}` : ''}`;
const ogUrl = `${Astro.site}${currentPath.slice(1)}`;
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>
    {description && <meta name="description" content={description} />}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content={ogUrl}>
    <meta property="og:title" content={ogTitle}>
    <meta property="og:description" content={ogDescription}>
    <meta property="og:image" content={ogImage}>

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content={ogUrl}>
    <meta property="twitter:title" content={ogTitle}>
    <meta property="twitter:description" content={ogDescription}>
    <meta property="twitter:image" content={ogImage}>

    <link rel="icon" type="image/png" href="/assets/svg/favicon.png">
    <link rel="preload" href="/assets/svg/fonts/OCR-B.ttf" as="font" type="font/ttf" crossorigin>
    <link rel="preload" href="/assets/svg/fonts/instrumentserif-italic.ttf" as="font" type="font/ttf" crossorigin>
    <link rel="stylesheet" href="/styles.css">
    <ViewTransitions />
</head>
<body class={`${isBlogPost ? 'blog-post' : ''} ${isExperiments ? 'experiments' : ''} ${isProjects ? 'projects' : ''} ${isAbout ? 'about' : ''}`}>
    <a href={backLink || (isBlogPost ? '/thoughts' : '/')} class="logo">
        <img src="/assets/svg/triangle.svg" alt="Logo" width="48" height="48">
    </a>

    <slot />
    <Analytics />
    <SpeedInsights />
</body>
</html>